
<!-- saved from url=(0048)https://f.daixianiu.cn/csdn/306756356487365.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="referrer" content="no-referrer">
             <style type="text/css"> .blog-content-box {position: relative;padding: 0 24px 16px;background: #fff;border-radius: 2px;}.article-info-box {position: relative;background: #f8f8f8;border-radius: 4px;}.article-bar-top {color: #999aaa;width: 88%;display: -webkit-box;display: -ms-flexbox;display: flex;}.article-copyright {padding: 8px;padding-left: 0;font-size: 14px;color: #6f6f82;}.article-source-link {color: #6f6f82;font-size: 13px;}.tag-link {-webkit-box-sizing: border-box;box-sizing: border-box;margin-right: 8px;padding: 3px 6px;font-size: 12px;background-color: #fff;color: #5094d5;border: 1px solid #eaeaef;height: 24px;line-height: 17px;border-radius: 2px;display: inline-block;}.tags-box {font-size: 14px;line-height: 24px;margin-bottom: 4px;margin-right: 8px;}</style>
            </head><body><div class="blog-content-box">
<div class="article-header-box">
<div class="article-header">
<div class="article-title-box">
<h1 class="title-article" id="articleContentId">OKX(欧易)交易所V5现货期货SDK-Python版</h1>
</div>
<div class="article-info-box">

<div class="blog-tags-box">
<div class="tags-box artic-tag-box">
<span class="label">分类专栏：</span>
<a class="tag-link" href="https://blog.csdn.net/bitquant/category_9911090.html" rel="noopener" target="_blank">数字货币交易所SDK</a>
<span class="label">文章标签：</span>
<a class="tag-link" data-report-click="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;python&quot;,&quot;ab&quot;:&quot;new&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;python\&quot;}&quot;}" href="https://so.csdn.net/so/search/s.do?q=python&amp;t=blog&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=" rel="noopener" target="_blank">python</a>
<a class="tag-link" data-report-click="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;开发语言&quot;,&quot;ab&quot;:&quot;new&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;开发语言\&quot;}&quot;}" href="https://so.csdn.net/so/search/s.do?q=%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80&amp;t=blog&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=" rel="noopener" target="_blank">开发语言</a>
<a class="tag-link" data-report-click="{&quot;mod&quot;:&quot;popu_626&quot;,&quot;spm&quot;:&quot;1001.2101.3001.4223&quot;,&quot;strategy&quot;:&quot;后端&quot;,&quot;ab&quot;:&quot;new&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;后端\&quot;}&quot;}" href="https://so.csdn.net/so/search/s.do?q=%E5%90%8E%E7%AB%AF&amp;t=blog&amp;o=vip&amp;s=&amp;l=&amp;f=&amp;viparticle=" rel="noopener" target="_blank">后端</a>
</div>
</div>

<div class="slide-content-box">
<div class="article-copyright">
<div class="creativecommons">
                            版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="noopener" target="_blank"> CC 4.0 BY-SA </a>版权协议，转载请附上原文出处链接和本声明。
                        </div>
<div class="article-source-link">
                            本文链接：<a href="https://blog.csdn.net/bitquant/article/details/122649363" target="_blank">https://blog.csdn.net/bitquant/article/details/122649363</a>
</div>
</div>
</div>

</div>
</div>
</div>
<div id="blogHuaweiyunAdvert"></div>


<article class="baidu_pl">
<div class="article_content clearfix" id="article_content">
<link href="./306756356487365_files/ck_htmledit_views-6e43165c0a.css" rel="stylesheet">
<div class="markdown_views prism-atom-one-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p>本文介绍OKX欧易交易所V5 SDK-Python版，该SDK包含现货和期货合约。</p>
<h2><a id="SDK_3"></a>一、SDK实现代码</h2>
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token comment"># OKX 欧易</span>
<span class="token comment"># https://www.okx.com</span>

<span class="token keyword">import</span> hmac<span class="token punctuation">,</span> base64
<span class="token keyword">import</span> time<span class="token punctuation">,</span> datetime
<span class="token keyword">import</span> math
<span class="token keyword">import</span> json<span class="token punctuation">,</span> copy<span class="token punctuation">,</span> urllib<span class="token punctuation">.</span>parse
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sys

<span class="token keyword">class</span> <span class="token class-name">OKXV5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    _api_url <span class="token operator">=</span> <span class="token string">"https://www.okx.com"</span>
    _ws_url <span class="token operator">=</span> <span class="token string">""</span>

    <span class="token comment">#初始化</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> apikey<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> secret<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> phrase<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_apikey <span class="token operator">=</span> apikey
        self<span class="token punctuation">.</span>_secret <span class="token operator">=</span> secret
        self<span class="token punctuation">.</span>_phrase <span class="token operator">=</span> phrase

    <span class="token comment"># 币种列表</span>
    <span class="token keyword">def</span> <span class="token function">coins</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>symbols<span class="token punctuation">(</span><span class="token punctuation">)</span>
        coins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">#所有币种</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> values <span class="token keyword">in</span> result<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> values<span class="token punctuation">[</span><span class="token string">'base'</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> coins<span class="token punctuation">:</span>
                coins<span class="token punctuation">.</span>append<span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token string">'base'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> coins

    <span class="token comment"># 交易对，包含markets and precisions</span>
    <span class="token keyword">def</span> <span class="token function">symbols</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> market<span class="token operator">=</span><span class="token string">'SPOT'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instType'</span> <span class="token punctuation">:</span> market
        <span class="token punctuation">}</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> <span class="token string">'/api/v5/public/instruments'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># print(result)</span>
        <span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        feelevel <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"1"</span><span class="token punctuation">:</span><span class="token number">0.001</span><span class="token punctuation">,</span>  <span class="token string">"2"</span><span class="token punctuation">:</span><span class="token number">0.0006</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">:</span><span class="token number">0.001</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">}</span> <span class="token comment">#Lv1 taker 吃单</span>
        <span class="token comment"># feelevel  = {"1":0.0, "2":0.0, "3":0.0, "4":0.0} #0手续费 用于测试</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> market <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"SWAP"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                symbol <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"instId"</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                symbol <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"baseCcy"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> item<span class="token punctuation">[</span><span class="token string">"quoteCcy"</span><span class="token punctuation">]</span>

            filter_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
            filter_dict<span class="token punctuation">[</span><span class="token string">'symbol'</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"instId"</span><span class="token punctuation">]</span>  <span class="token comment">#原始symbol</span>
            filter_dict<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"instType"</span><span class="token punctuation">]</span>
            filter_dict<span class="token punctuation">[</span><span class="token string">'price'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"tickSz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            filter_dict<span class="token punctuation">[</span><span class="token string">'quantity'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"lotSz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            filter_dict<span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"minSz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            filter_dict<span class="token punctuation">[</span><span class="token string">'fee'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>feelevel<span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token string">"category"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            filter_dict<span class="token punctuation">[</span><span class="token string">'feelevel'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"category"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> market <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"SWAP"</span><span class="token punctuation">,</span> <span class="token string">"MARGIN"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                filter_dict<span class="token punctuation">[</span><span class="token string">'lever'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"lever"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># print(symbol)</span>
            <span class="token keyword">if</span> market <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"SPOT"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                filter_dict<span class="token punctuation">[</span><span class="token string">'base'</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"baseCcy"</span><span class="token punctuation">]</span>
                filter_dict<span class="token punctuation">[</span><span class="token string">'quote'</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"quoteCcy"</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> market <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"SWAP"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                filter_dict<span class="token punctuation">[</span><span class="token string">'ctval'</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"ctVal"</span><span class="token punctuation">]</span>
                filter_dict<span class="token punctuation">[</span><span class="token string">'ctmult'</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"ctMult"</span><span class="token punctuation">]</span>
                filter_dict<span class="token punctuation">[</span><span class="token string">'cttype'</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"ctType"</span><span class="token punctuation">]</span>
                filter_dict<span class="token punctuation">[</span><span class="token string">'ctvalccy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"ctValCcy"</span><span class="token punctuation">]</span>
                filter_dict<span class="token punctuation">[</span><span class="token string">'quantity'</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"lotSz"</span><span class="token punctuation">]</span>
            <span class="token comment"># print(item)</span>
            <span class="token comment"># print(filter_dict)</span>
            <span class="token builtin">dict</span><span class="token punctuation">[</span>symbol<span class="token punctuation">]</span> <span class="token operator">=</span> filter_dict
        <span class="token keyword">return</span> <span class="token builtin">dict</span>

    <span class="token comment"># 行情</span>
    <span class="token keyword">def</span> <span class="token function">ticker</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token operator">=</span><span class="token string">'BTC_USDT'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        params <span class="token operator">=</span>  <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> <span class="token string">'/api/v5/market/ticker'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'bid'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"bidPx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ask'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"askPx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'last'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"last"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'high'</span><span class="token punctuation">:</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"high24h"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'low'</span><span class="token punctuation">:</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"low24h"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token builtin">dict</span>

    <span class="token comment"># 所有行情</span>
    <span class="token keyword">def</span> <span class="token function">tickers</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> market<span class="token operator">=</span><span class="token string">'SPOT'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instType'</span> <span class="token punctuation">:</span> market
        <span class="token punctuation">}</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> <span class="token string">'/api/v5/market/tickers'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># print(result)</span>
        ticker_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token string">'data'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

        <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            symbol <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"instId"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> market <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"SWAP"</span><span class="token punctuation">,</span> <span class="token string">"MARGIN"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                symbol <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"instId"</span><span class="token punctuation">]</span>

            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">"askPx"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">or</span> item<span class="token punctuation">[</span><span class="token string">"askSz"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">or</span> item<span class="token punctuation">[</span><span class="token string">"bidPx"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">or</span> item<span class="token punctuation">[</span><span class="token string">"bidSz"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token keyword">or</span> item<span class="token punctuation">[</span><span class="token string">"ts"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                ticker_dict<span class="token punctuation">[</span>symbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'ask'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"askPx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'quantity'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"askSz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                       <span class="token string">'bid'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"bidPx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'quantity'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"bidSz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                       <span class="token string">'last'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"last"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                       <span class="token string">'ts'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"ts"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token keyword">if</span> market <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"SWAP"</span><span class="token punctuation">,</span> <span class="token string">"MARGIN"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    ticker_dict<span class="token punctuation">[</span>symbol<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'vol24h'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"vol24h"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>symbol<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> ticker_dict

    <span class="token comment"># 深度</span>
    <span class="token keyword">def</span> <span class="token function">depth</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol <span class="token operator">=</span> <span class="token string">'BTC_USDT'</span><span class="token punctuation">,</span> limit <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'sz'</span> <span class="token punctuation">:</span> limit
        <span class="token punctuation">}</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> <span class="token string">'/api/v5/market/books'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        bids<span class="token punctuation">,</span> asks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"bids"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"asks"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> limit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            bids<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">"bids"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">"bids"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            asks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">"asks"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">"asks"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'asks'</span><span class="token punctuation">:</span> asks<span class="token punctuation">,</span> <span class="token string">'bids'</span><span class="token punctuation">:</span> bids<span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token builtin">dict</span>

    <span class="token comment"># 获取交易信息(60条)</span>
    <span class="token keyword">def</span> <span class="token function">trades</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol <span class="token operator">=</span> <span class="token string">'BTC_USDT'</span><span class="token punctuation">,</span> limit <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'limit'</span><span class="token punctuation">:</span> limit
        <span class="token punctuation">}</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> <span class="token string">'/api/v5/market/trades'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'orderid'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"tradeId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"ts"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"px"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'quantity'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"sz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'side'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"side"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">list</span>

    <span class="token comment"># k线</span>
    <span class="token keyword">def</span> <span class="token function">kline</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol <span class="token operator">=</span> <span class="token string">'BTC_USDT'</span><span class="token punctuation">,</span> interval <span class="token operator">=</span> <span class="token string">'1hour'</span><span class="token punctuation">,</span> limit <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">,</span> start <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        xdict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"1min"</span><span class="token punctuation">:</span><span class="token string">"1m"</span><span class="token punctuation">,</span>
            <span class="token string">"3min"</span><span class="token punctuation">:</span><span class="token string">"3m"</span><span class="token punctuation">,</span>
            <span class="token string">"5min"</span><span class="token punctuation">:</span><span class="token string">"5m"</span><span class="token punctuation">,</span>
            <span class="token string">"10min"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"15min"</span><span class="token punctuation">:</span><span class="token string">"15m"</span><span class="token punctuation">,</span>
            <span class="token string">"30min"</span><span class="token punctuation">:</span><span class="token string">"30m"</span><span class="token punctuation">,</span>
            <span class="token string">"1hour"</span><span class="token punctuation">:</span><span class="token string">"1H"</span><span class="token punctuation">,</span>
            <span class="token string">"2hour"</span><span class="token punctuation">:</span><span class="token string">"2H"</span><span class="token punctuation">,</span>
            <span class="token string">"3hour"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"4hour"</span><span class="token punctuation">:</span><span class="token string">"4H"</span><span class="token punctuation">,</span>
            <span class="token string">"6hour"</span><span class="token punctuation">:</span><span class="token string">"6H"</span><span class="token punctuation">,</span>
            <span class="token string">"8hour"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"12hour"</span><span class="token punctuation">:</span><span class="token string">"12H"</span><span class="token punctuation">,</span>
            <span class="token string">"1day"</span><span class="token punctuation">:</span><span class="token string">"1D"</span><span class="token punctuation">,</span>
            <span class="token string">"3day"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"1week"</span><span class="token punctuation">:</span><span class="token string">"1W"</span><span class="token punctuation">,</span>
            <span class="token string">"2week"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"1month"</span><span class="token punctuation">:</span><span class="token string">"1M"</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> xdict<span class="token punctuation">[</span>interval<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'不支持的K线周期 %s not support %s'</span><span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_exchange<span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'bar'</span> <span class="token punctuation">:</span> xdict<span class="token punctuation">[</span>interval<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'limit'</span><span class="token punctuation">:</span> limit
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> start<span class="token punctuation">:</span>
            params<span class="token punctuation">[</span><span class="token string">"before"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'%s000'</span><span class="token operator">%</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span>
        <span class="token keyword">if</span> end<span class="token punctuation">:</span>
            params<span class="token punctuation">[</span><span class="token string">"after"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'%s000'</span><span class="token operator">%</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span>

        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> <span class="token string">'/api/v5/market/candles'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># print(result)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span> <span class="token comment">#限速： OKEX  20次/2s</span>
        <span class="token comment"># if (len(result['data']) &lt; 60): #分析最小要求 60</span>
            <span class="token comment"># self._x_print(symbol, sys._getframe().f_code.co_name, interval + " 数组维度过小" + str(len(data)))</span>

        stamp<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">,</span> high<span class="token punctuation">,</span> low<span class="token punctuation">,</span> close<span class="token punctuation">,</span> volume <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            stamp<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token builtin">open</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            high<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            low<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            close<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            volume<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>high<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>low<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>close<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>volume<span class="token punctuation">)</span>

    <span class="token comment"># k线</span>
    <span class="token keyword">def</span> <span class="token function">kline_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol <span class="token operator">=</span> <span class="token string">'BTC_USDT'</span><span class="token punctuation">,</span> interval <span class="token operator">=</span> <span class="token string">'1hour'</span><span class="token punctuation">,</span> limit <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">,</span> start <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        xdict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"1min"</span><span class="token punctuation">:</span><span class="token string">"1m"</span><span class="token punctuation">,</span>
            <span class="token string">"3min"</span><span class="token punctuation">:</span><span class="token string">"3m"</span><span class="token punctuation">,</span>
            <span class="token string">"5min"</span><span class="token punctuation">:</span><span class="token string">"5m"</span><span class="token punctuation">,</span>
            <span class="token string">"10min"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"15min"</span><span class="token punctuation">:</span><span class="token string">"15m"</span><span class="token punctuation">,</span>
            <span class="token string">"30min"</span><span class="token punctuation">:</span><span class="token string">"30m"</span><span class="token punctuation">,</span>
            <span class="token string">"1hour"</span><span class="token punctuation">:</span><span class="token string">"1H"</span><span class="token punctuation">,</span>
            <span class="token string">"2hour"</span><span class="token punctuation">:</span><span class="token string">"2H"</span><span class="token punctuation">,</span>
            <span class="token string">"3hour"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"4hour"</span><span class="token punctuation">:</span><span class="token string">"4H"</span><span class="token punctuation">,</span>
            <span class="token string">"6hour"</span><span class="token punctuation">:</span><span class="token string">"6H"</span><span class="token punctuation">,</span>
            <span class="token string">"8hour"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"12hour"</span><span class="token punctuation">:</span><span class="token string">"12H"</span><span class="token punctuation">,</span>
            <span class="token string">"1day"</span><span class="token punctuation">:</span><span class="token string">"1D"</span><span class="token punctuation">,</span>
            <span class="token string">"3day"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"1week"</span><span class="token punctuation">:</span><span class="token string">"1W"</span><span class="token punctuation">,</span>
            <span class="token string">"2week"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"1month"</span><span class="token punctuation">:</span><span class="token string">"1M"</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> xdict<span class="token punctuation">[</span>interval<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'不支持的K线周期 %s not support %s'</span><span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_exchange<span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'bar'</span> <span class="token punctuation">:</span> xdict<span class="token punctuation">[</span>interval<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'limit'</span><span class="token punctuation">:</span> limit
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> start<span class="token punctuation">:</span>
            params<span class="token punctuation">[</span><span class="token string">"before"</span><span class="token punctuation">]</span> <span class="token operator">=</span> start
        <span class="token keyword">if</span> end<span class="token punctuation">:</span>
            params<span class="token punctuation">[</span><span class="token string">"after"</span><span class="token punctuation">]</span> <span class="token operator">=</span> end

        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> <span class="token string">'/api/v5/market/history-candles'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#分析最小要求 60</span>
            self<span class="token punctuation">.</span>_x_print<span class="token punctuation">(</span>symbol<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>_getframe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>f_code<span class="token punctuation">.</span>co_name<span class="token punctuation">,</span> interval <span class="token operator">+</span> <span class="token string">" 数组维度过小"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        stamp<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">,</span> high<span class="token punctuation">,</span> low<span class="token punctuation">,</span> close<span class="token punctuation">,</span> volume <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            stamp<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
            <span class="token builtin">open</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            high<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            low<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            close<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            volume<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>high<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>low<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>close<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>volume<span class="token punctuation">)</span>

    <span class="token comment"># 账号</span>
    <span class="token keyword">def</span> <span class="token function">account</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        path <span class="token operator">=</span> <span class="token string">'/api/v5/account/balance'</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># print(result)</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
            <span class="token keyword">return</span> result

        <span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"details"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            free <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"availBal"</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"availBal"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">else</span> item<span class="token punctuation">[</span><span class="token string">"availEq"</span><span class="token punctuation">]</span>
            <span class="token comment"># if market in ['SPOT']: #现货</span>
                <span class="token comment"># dict[item["ccy"]] = {'free':float(item["availBal"]), 'locked':float(item["frozenBal"]), "total":float(item["cashBal"]), "usd":float(item["eqUsd"])}</span>
            <span class="token comment"># elif market in ['SWAP', 'MARGIN']:  #杠杆, 永续，交割</span>
                <span class="token comment"># dict[item["ccy"]] = {'free':float(item["availEq"]), 'locked':float(item["frozenBal"]), "total":float(item["cashBal"]), "usd":float(item["eqUsd"])}</span>
            <span class="token builtin">dict</span><span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token string">"ccy"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'free'</span><span class="token punctuation">:</span><span class="token builtin">float</span><span class="token punctuation">(</span>free<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'locked'</span><span class="token punctuation">:</span><span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"frozenBal"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"total"</span><span class="token punctuation">:</span><span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"eq"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"usd"</span><span class="token punctuation">:</span><span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"eqUsd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token builtin">dict</span>


    <span class="token comment"># 查看账户配置</span>
    <span class="token keyword">def</span> <span class="token function">account_config</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

        path <span class="token operator">=</span> <span class="token string">'/api/v5/account/config'</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>

    <span class="token comment"># 设置杠杆倍数</span>
    <span class="token keyword">def</span> <span class="token function">account_leverage</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> lever<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"ISOLATED"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> mode <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"ISOLATED"</span><span class="token punctuation">,</span> <span class="token string">"CROSS"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"ERROR params mode %s "</span><span class="token operator">%</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        path <span class="token operator">=</span> <span class="token string">'/api/v5/account/set-leverage'</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span>    <span class="token punctuation">:</span>self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'lever'</span>     <span class="token punctuation">:</span>lever<span class="token punctuation">,</span>
            <span class="token string">'mgnMode'</span>   <span class="token punctuation">:</span>mode<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">,</span> params <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'errcode'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'errmsg'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'symbol'</span><span class="token punctuation">:</span> symbol<span class="token punctuation">,</span> <span class="token string">'lever'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'lever'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'mode'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'mgnMode'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

    <span class="token comment"># 下订单</span>
    <span class="token keyword">def</span> <span class="token function">order</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> side<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"CASH"</span><span class="token punctuation">,</span> posside<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> side <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"BUY"</span><span class="token punctuation">,</span> <span class="token string">"SELL"</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token builtin">type</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"MARKET"</span><span class="token punctuation">,</span><span class="token string">"LIMIT"</span><span class="token punctuation">,</span><span class="token string">"POST_ONLY"</span><span class="token punctuation">,</span><span class="token string">"FOK"</span><span class="token punctuation">,</span><span class="token string">"IOC"</span><span class="token punctuation">,</span><span class="token string">"OPTIMAL_LIMIT_IOC"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"ERROR params side %s type %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>side<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        <span class="token keyword">if</span> mode <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"ISOLATED"</span><span class="token punctuation">,</span> <span class="token string">"CROSS"</span><span class="token punctuation">,</span> <span class="token string">"CASH"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"ERROR params mode %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        <span class="token comment">#科学计数法转为字符串提交</span>
        <span class="token keyword">if</span> <span class="token string">'e-'</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token punctuation">:</span>
            price <span class="token operator">=</span> <span class="token string">'%.20f'</span><span class="token operator">%</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token string">'e-'</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token punctuation">:</span>
            quantity <span class="token operator">=</span> <span class="token string">'%.20f'</span><span class="token operator">%</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span>

        path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/order'</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span>    <span class="token punctuation">:</span>self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'tdMode'</span>    <span class="token punctuation">:</span>mode<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'side'</span>      <span class="token punctuation">:</span>side<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'ordType'</span>   <span class="token punctuation">:</span><span class="token builtin">type</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'px'</span>        <span class="token punctuation">:</span>price<span class="token punctuation">,</span>
            <span class="token string">'sz'</span>        <span class="token punctuation">:</span>quantity
        <span class="token punctuation">}</span>

        <span class="token comment">#  sz 当币币/币币杠杆以市价买入时，指计价货币的数量</span>
        <span class="token keyword">if</span> side <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"BUY"</span><span class="token punctuation">]</span> <span class="token keyword">and</span> <span class="token builtin">type</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"MARKET"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token comment">#市价买单不传price</span>
            body<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'px'</span><span class="token punctuation">)</span>
            body<span class="token punctuation">[</span><span class="token string">'sz'</span><span class="token punctuation">]</span> <span class="token operator">=</span> price
        <span class="token keyword">if</span> posside<span class="token punctuation">:</span>
            body<span class="token punctuation">[</span><span class="token string">'posSide'</span><span class="token punctuation">]</span> <span class="token operator">=</span> posside<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            body<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
        <span class="token keyword">print</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">,</span> params <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'errcode'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sCode'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'errmsg'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sMsg'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'orderid'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'ordId'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

    <span class="token comment"># 订单取消</span>
    <span class="token keyword">def</span> <span class="token function">order_cancel</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> orderid<span class="token punctuation">)</span><span class="token punctuation">:</span>
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'ordId'</span> <span class="token punctuation">:</span> orderid
        <span class="token punctuation">}</span>
        path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/cancel-order'</span>

        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">,</span> params <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'errcode'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sCode'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'errmsg'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sMsg'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span>

    <span class="token comment"># 订单查询</span>
    <span class="token keyword">def</span> <span class="token function">order_query</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> orderid<span class="token punctuation">)</span><span class="token punctuation">:</span>
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'ordId'</span> <span class="token punctuation">:</span> orderid
        <span class="token punctuation">}</span>
        path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/order'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>body<span class="token punctuation">)</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        types <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"live"</span><span class="token punctuation">:</span><span class="token string">"SUBMITTED"</span><span class="token punctuation">,</span>
            <span class="token string">"partially_filled"</span><span class="token punctuation">:</span><span class="token string">"PARTIALLY_FILLED"</span><span class="token punctuation">,</span>
            <span class="token string">"filled"</span><span class="token punctuation">:</span><span class="token string">"FILLED"</span><span class="token punctuation">,</span>
            <span class="token string">"canceled"</span><span class="token punctuation">:</span><span class="token string">"CANCELED"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'symbol'</span><span class="token punctuation">:</span>   symbol<span class="token punctuation">,</span>
            <span class="token string">'trade'</span><span class="token punctuation">:</span>    result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"instType"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span>    result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"lever"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'mode'</span><span class="token punctuation">:</span>     result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tdMode"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'orderid'</span><span class="token punctuation">:</span>  result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"ordId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'price'</span><span class="token punctuation">:</span>    <span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"avgPx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"avgPx"</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"px"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'quantity'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"sz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'status'</span><span class="token punctuation">:</span>   types<span class="token punctuation">[</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"state"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'type'</span><span class="token punctuation">:</span>     result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"ordType"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'side'</span><span class="token punctuation">:</span>     result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"side"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'time'</span><span class="token punctuation">:</span>     result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"cTime"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token builtin">dict</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'errcode'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'errmsg'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

    <span class="token comment"># 未成交订单</span>
    <span class="token keyword">def</span> <span class="token function">order_open</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>  symbol<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> market<span class="token operator">=</span><span class="token string">'SPOT'</span><span class="token punctuation">,</span>  <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instType'</span><span class="token punctuation">:</span> market
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> symbol<span class="token punctuation">:</span>
           body<span class="token punctuation">[</span><span class="token string">'instId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span>

        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            body<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
        path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/orders-pending'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>body<span class="token punctuation">)</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token comment"># print(item)</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'symbol'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"instId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'trade'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"instType"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'level'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"lever"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'mode'</span><span class="token punctuation">:</span>item<span class="token punctuation">[</span><span class="token string">"tdMode"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'orderid'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"ordId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"cTime"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"px"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'quantity'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"sz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'side'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"side"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"ordType"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>


        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token comment"># print(len(result["data"])) #未生效</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>self<span class="token punctuation">.</span>order_open<span class="token punctuation">(</span>after <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"ordId"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">list</span>

    <span class="token comment"># 历史订单（已成交）（7/30天）</span>
    <span class="token keyword">def</span> <span class="token function">order_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> instType<span class="token operator">=</span><span class="token string">'SPOT'</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instType'</span><span class="token punctuation">:</span> instType<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> symbol<span class="token punctuation">:</span>
           params<span class="token punctuation">[</span><span class="token string">'instId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
        <span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/orders-history'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token comment">#7天</span>
        <span class="token comment"># path = '/api/v5/trade/orders-history-archive' + "?" + urllib.parse.urlencode(params) #30天</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span>
        types <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"live"</span><span class="token punctuation">:</span><span class="token string">"SUBMITTED"</span><span class="token punctuation">,</span>
            <span class="token string">"partially_filled"</span><span class="token punctuation">:</span><span class="token string">"PARTIALLY_FILLED"</span><span class="token punctuation">,</span>
            <span class="token string">"filled"</span><span class="token punctuation">:</span><span class="token string">"FILLED"</span><span class="token punctuation">,</span>
            <span class="token string">"canceled"</span><span class="token punctuation">:</span><span class="token string">"CANCELED"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            symbol <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"instId"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                price <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">"avgPx"</span><span class="token punctuation">]</span> <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">"avgPx"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">''</span> <span class="token keyword">else</span> item<span class="token punctuation">[</span><span class="token string">"px"</span><span class="token punctuation">]</span>
                <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'orderid'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"ordId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'symbol'</span><span class="token punctuation">:</span>symbol<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> symbol<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"uTime"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'quantity'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"sz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'side'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"side"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"ordType"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'status'</span><span class="token punctuation">:</span>types<span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token string">"state"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">repr</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>self<span class="token punctuation">.</span>order_history<span class="token punctuation">(</span>after <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"ordId"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token builtin">list</span>

    <span class="token comment"># 查看持仓信息</span>
    <span class="token keyword">def</span> <span class="token function">positions</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> market<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">if</span> market<span class="token punctuation">:</span>
            body<span class="token punctuation">[</span><span class="token string">'instType'</span><span class="token punctuation">]</span> <span class="token operator">=</span> market
        <span class="token keyword">if</span> symbol<span class="token punctuation">:</span>
            body<span class="token punctuation">[</span><span class="token string">'instId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span>
        <span class="token keyword">if</span> body<span class="token punctuation">:</span>
            path <span class="token operator">=</span> <span class="token string">'/api/v5/account/positions'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>body<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            path <span class="token operator">=</span> <span class="token string">'/api/v5/account/positions'</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># print(result)</span>
        <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token comment"># if float(item["pos"]) &gt; 0.0:  #如果该instId拥有过的仓位，将返回持仓信息，不管持仓量是否为0；否则不返回</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'symbol'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"instId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'posid'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"posId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'tradeid'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"tradeId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"instType"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'mode'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"mgnMode"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'side'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"posSide"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'adl'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"adl"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'usd'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"notionalUsd"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'avgprice'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"avgPx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'pos'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"pos"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'upl'</span><span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"upl"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'uplratio'</span><span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"uplRatio"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'lever'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"lever"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'liqprice'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"liqPx"</span><span class="token punctuation">]</span> <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">"liqPx"</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'margin'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"margin"</span><span class="token punctuation">]</span> <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">"margin"</span><span class="token punctuation">]</span> <span class="token keyword">else</span> item<span class="token punctuation">[</span><span class="token string">"imr"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'mgnratio'</span><span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"mgnRatio"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'mmr'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"mmr"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'ccy'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"ccy"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'ctime'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"cTime"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token builtin">list</span>


    <span class="token comment">#市价仓位全平</span>
    <span class="token keyword">def</span> <span class="token function">position_close</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> side<span class="token operator">=</span><span class="token string">'NET'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'ISOLATED'</span><span class="token punctuation">,</span> ccy<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/close-position'</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path

        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span> <span class="token punctuation">:</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'posSide'</span> <span class="token punctuation">:</span> side<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'mgnMode'</span><span class="token punctuation">:</span> mode<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> ccy<span class="token punctuation">:</span>
            body<span class="token punctuation">[</span><span class="token string">'ccy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> ccy

        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">,</span> params <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># print(result)</span>

        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'errcode'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'errmsg'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'symbol'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'instId'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

    <span class="token comment"># 策略委托下单   单向止盈止损委托 、双向止盈止损委托、计划委托、冰山委托、时间加权委托</span>
    <span class="token keyword">def</span> <span class="token function">order_algo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> side<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'CASH'</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> side <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"BUY"</span><span class="token punctuation">,</span> <span class="token string">"SELL"</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token builtin">type</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"CONDITIONAL"</span><span class="token punctuation">,</span> <span class="token string">"OCO"</span><span class="token punctuation">,</span> <span class="token string">"TRIGGER"</span><span class="token punctuation">,</span> <span class="token string">"ICEBERG"</span><span class="token punctuation">,</span> <span class="token string">"TWAP"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"ERROR params side %s type %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>side<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        <span class="token keyword">if</span> mode <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"ISOLATED"</span><span class="token punctuation">,</span> <span class="token string">"CROSS"</span><span class="token punctuation">,</span> <span class="token string">"CASH"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"ERROR params mode %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/order-algo'</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span>    <span class="token punctuation">:</span>self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'tdMode'</span>    <span class="token punctuation">:</span>mode<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'side'</span>      <span class="token punctuation">:</span>side<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'ordType'</span>   <span class="token punctuation">:</span><span class="token builtin">type</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'sz'</span>        <span class="token punctuation">:</span>quantity
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            body<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
        <span class="token comment"># print(body)</span>
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">,</span> params <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># print(result)</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'errcode'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sCode'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'errmsg'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sMsg'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'algoid'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'algoId'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

    <span class="token comment"># 策略委托订单撤销</span>
    <span class="token keyword">def</span> <span class="token function">order_algo_cancel</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> algoid<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"TRIGGER"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        body <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'algoId'</span> <span class="token punctuation">:</span> algoid
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token builtin">type</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"CONDITIONAL"</span><span class="token punctuation">,</span> <span class="token string">"OCO"</span><span class="token punctuation">,</span> <span class="token string">"TRIGGER"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/cancel-algos'</span>
        <span class="token keyword">elif</span> <span class="token builtin">type</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"ICEBERG"</span><span class="token punctuation">,</span> <span class="token string">"TWAP"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/cancel-advance-algos'</span>

        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">,</span> params <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'errcode'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sCode'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'errmsg'</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sMsg'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'result'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span>

    <span class="token comment"># 策略委托订单查询</span>
    <span class="token keyword">def</span> <span class="token function">order_algo_query</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> algoid<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"TRIGGER"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'instId'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'algoId'</span> <span class="token punctuation">:</span> algoid<span class="token punctuation">,</span>
            <span class="token string">'ordType'</span> <span class="token punctuation">:</span> <span class="token builtin">type</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/orders-algo-history'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>body<span class="token punctuation">)</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">)</span>

        types <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"effective"</span><span class="token punctuation">:</span><span class="token string">"EFFECTIVE"</span><span class="token punctuation">,</span>
            <span class="token string">"order_failed"</span><span class="token punctuation">:</span><span class="token string">"FAILED"</span><span class="token punctuation">,</span>
            <span class="token string">"canceled"</span><span class="token punctuation">:</span><span class="token string">"CANCELED"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">'symbol'</span><span class="token punctuation">:</span>   symbol<span class="token punctuation">,</span>
                <span class="token string">'algoid'</span><span class="token punctuation">:</span>  result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"algoId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'orderid'</span><span class="token punctuation">:</span>  result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"ordId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'tprice'</span><span class="token punctuation">:</span>    <span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"triggerPx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'price'</span><span class="token punctuation">:</span>    <span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"ordPx"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'quantity'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"sz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'status'</span><span class="token punctuation">:</span>   types<span class="token punctuation">[</span>result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"state"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span>     result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"ordType"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'side'</span><span class="token punctuation">:</span>     result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"side"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'time'</span><span class="token punctuation">:</span>     result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"cTime"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token builtin">dict</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            result2 <span class="token operator">=</span> self<span class="token punctuation">.</span>order_algo_open<span class="token punctuation">(</span>symbol<span class="token operator">=</span>symbol<span class="token punctuation">,</span> algoid<span class="token operator">=</span>algoid<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">type</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> result2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment"># 策略委托未成交订单列表</span>
    <span class="token keyword">def</span> <span class="token function">order_algo_open</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> symbol<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> algoid<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"TRIGGER"</span><span class="token punctuation">,</span> itype<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'ordType'</span> <span class="token punctuation">:</span> <span class="token builtin">type</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> itype<span class="token punctuation">:</span>
           body<span class="token punctuation">[</span><span class="token string">'instType'</span><span class="token punctuation">]</span> <span class="token operator">=</span> itype
        <span class="token keyword">if</span> symbol<span class="token punctuation">:</span>
           body<span class="token punctuation">[</span><span class="token string">'instId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_x_symbol<span class="token punctuation">(</span>symbol<span class="token punctuation">)</span>
        <span class="token keyword">if</span> algoid<span class="token punctuation">:</span>
           body<span class="token punctuation">[</span><span class="token string">'algoId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> algoid

        path <span class="token operator">=</span> <span class="token string">'/api/v5/trade/orders-algo-pending'</span> <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>body<span class="token punctuation">)</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>_api_url <span class="token operator">+</span> path
        params2 <span class="token operator">=</span> self<span class="token punctuation">.</span>signature<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token comment">#限速： OKEX  20次/2s</span>
        result <span class="token operator">=</span> self<span class="token punctuation">.</span>http_request_v2<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">(</span>params2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># print(result)</span>
        <span class="token builtin">list</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token builtin">list</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'symbol'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"instId"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'algoid'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"algoId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'orderid'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"ordId"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"cTime"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ordPx'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"ordPx"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'triggerPx'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"triggerPx"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'slTriggerPx'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"slTriggerPx"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'quantity'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"sz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'side'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"side"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">"ordType"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token string">"SUBMITTED"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">list</span>

    <span class="token comment"># 生成headers头</span>
    <span class="token keyword">def</span> <span class="token function">header</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/json'</span>
        headers<span class="token punctuation">[</span><span class="token string">'OK-ACCESS-KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_apikey
        headers<span class="token punctuation">[</span><span class="token string">'OK-ACCESS-SIGN'</span><span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">"sign"</span><span class="token punctuation">]</span>
        headers<span class="token punctuation">[</span><span class="token string">'OK-ACCESS-TIMESTAMP'</span><span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">"timestamp"</span><span class="token punctuation">]</span>
        headers<span class="token punctuation">[</span><span class="token string">'OK-ACCESS-PASSPHRASE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_phrase
        <span class="token keyword">if</span> <span class="token string">"MONI"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>_phrase<span class="token punctuation">:</span>
            headers<span class="token punctuation">[</span><span class="token string">'x-simulated-trading'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token comment">#模拟盘</span>
        <span class="token keyword">return</span> headers

    <span class="token comment"># 签名函数</span>
    <span class="token keyword">def</span> <span class="token function">signature</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> body<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        timestamp <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token string">"T"</span><span class="token punctuation">,</span> <span class="token string">"milliseconds"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"Z"</span>
        params2 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'timestamp'</span><span class="token punctuation">:</span> timestamp<span class="token punctuation">}</span>
        message <span class="token operator">=</span> params2<span class="token punctuation">[</span><span class="token string">"timestamp"</span><span class="token punctuation">]</span> <span class="token operator">+</span> method <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">""</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>
        mac <span class="token operator">=</span> hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_secret<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> digestmod<span class="token operator">=</span><span class="token string">'sha256'</span><span class="token punctuation">)</span>
        params2<span class="token punctuation">[</span><span class="token string">"sign"</span><span class="token punctuation">]</span> <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>mac<span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> params2

    <span class="token comment"># http请求v2, headers单独传参</span>
    <span class="token keyword">def</span> <span class="token function">http_request_v2</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"GET"</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        headers<span class="token punctuation">[</span><span class="token string">'User-Agent'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Mozilla/5.0 \(Windows NT 6.1; WOW64\) AppleWebKit/537.36 \(KHTML, like Gecko\) Chrome/39.0.2171.71 Safari/537.36'</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>
                response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
                response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>params<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> method <span class="token operator">==</span> <span class="token string">"DELETE"</span><span class="token punctuation">:</span>
                response <span class="token operator">=</span> requests<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>params<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
            result <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># print(result)</span>
            <span class="token keyword">return</span> result
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>


</code></pre>
<h2><a id="_664"></a>二、调用方法</h2>
<h3><a id="1_665"></a>1、公共数据</h3>
<pre><code class="prism language-python">symbol <span class="token operator">=</span> <span class="token string">"BTC-USDT"</span>
exchange <span class="token operator">=</span> OKXV5<span class="token punctuation">(</span><span class="token punctuation">)</span>
symbols <span class="token operator">=</span> exchange<span class="token punctuation">.</span>symbols<span class="token punctuation">(</span>market<span class="token operator">=</span><span class="token string">'SWAP'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>symbols<span class="token punctuation">)</span>
</code></pre>
<p>返回（U本位永续合约为例）</p>
<pre><code class="prism language-python"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"BTC-USDT-SWAP"</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"symbol"</span><span class="token punctuation">:</span><span class="token string">"BTC-USDT-SWAP"</span><span class="token punctuation">,</span>
        <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"SWAP"</span><span class="token punctuation">,</span>
        <span class="token string">"price"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token string">"min"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"fee"</span><span class="token punctuation">:</span><span class="token number">0.001</span><span class="token punctuation">,</span>
        <span class="token string">"feelevel"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"lever"</span><span class="token punctuation">:</span><span class="token number">125</span><span class="token punctuation">,</span>
        <span class="token string">"ctval"</span><span class="token punctuation">:</span><span class="token string">"0.01"</span><span class="token punctuation">,</span>
        <span class="token string">"ctmult"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token string">"cttype"</span><span class="token punctuation">:</span><span class="token string">"linear"</span><span class="token punctuation">,</span>
        <span class="token string">"ctvalccy"</span><span class="token punctuation">:</span><span class="token string">"BTC"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"ETH-USDT-SWAP"</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"symbol"</span><span class="token punctuation">:</span><span class="token string">"ETH-USDT-SWAP"</span><span class="token punctuation">,</span>
        <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"SWAP"</span><span class="token punctuation">,</span>
        <span class="token string">"price"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token string">"min"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"fee"</span><span class="token punctuation">:</span><span class="token number">0.001</span><span class="token punctuation">,</span>
        <span class="token string">"feelevel"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"lever"</span><span class="token punctuation">:</span><span class="token number">125</span><span class="token punctuation">,</span>
        <span class="token string">"ctval"</span><span class="token punctuation">:</span><span class="token string">"0.1"</span><span class="token punctuation">,</span>
        <span class="token string">"ctmult"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token string">"cttype"</span><span class="token punctuation">:</span><span class="token string">"linear"</span><span class="token punctuation">,</span>
        <span class="token string">"ctvalccy"</span><span class="token punctuation">:</span><span class="token string">"ETH"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="2_707"></a>2、私有数据</h3>
<pre><code class="prism language-python">exchange <span class="token operator">=</span> OKXV5<span class="token punctuation">(</span>apikey<span class="token operator">=</span><span class="token string">"11111111-1111-1111-111-111111111"</span><span class="token punctuation">,</span> secret<span class="token operator">=</span><span class="token string">"22222222222222222222"</span><span class="token punctuation">,</span> phrase<span class="token operator">=</span><span class="token string">"333333"</span><span class="token punctuation">)</span>
account <span class="token operator">=</span> exchange<span class="token punctuation">.</span>account<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span>
</code></pre>
<p>返回</p>
<pre><code class="prism language-python"><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
ID      COIN                FREE                    LOCKED                  TOTAL                   USD
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token number">1</span>       USDC         <span class="token number">101045.63759982</span>              <span class="token number">0.00000000</span>         <span class="token number">101045.63759982</span>         <span class="token number">101045.63759982</span>
<span class="token number">2</span>       BTC               <span class="token number">1.00000000</span>              <span class="token number">0.00000000</span>              <span class="token number">1.00000000</span>          <span class="token number">35255.50000000</span>
<span class="token number">3</span>       ETH               <span class="token number">5.00000000</span>              <span class="token number">0.00000000</span>              <span class="token number">5.00000000</span>          <span class="token number">12312.25000000</span>
<span class="token number">4</span>       UNI             <span class="token number">500.00000000</span>              <span class="token number">0.00000000</span>            <span class="token number">500.00000000</span>           <span class="token number">5731.00000000</span>
<span class="token number">5</span>       JFI             <span class="token number">100.00000000</span>              <span class="token number">0.00000000</span>            <span class="token number">100.00000000</span>           <span class="token number">4481.79200000</span>
<span class="token number">6</span>       USDT           <span class="token number">1878.75850180</span>           <span class="token number">1228.58872870</span>           <span class="token number">3107.34723050</span>           <span class="token number">3108.68338981</span>
<span class="token number">7</span>       TUSD           <span class="token number">3000.00000000</span>              <span class="token number">0.00000000</span>           <span class="token number">3000.00000000</span>           <span class="token number">3000.00000000</span>
<span class="token number">8</span>       USDK           <span class="token number">3000.00000000</span>              <span class="token number">0.00000000</span>           <span class="token number">3000.00000000</span>           <span class="token number">3000.00000000</span>
<span class="token number">9</span>       OKB             <span class="token number">100.00000000</span>              <span class="token number">0.00000000</span>            <span class="token number">100.00000000</span>           <span class="token number">2061.20000000</span>
<span class="token number">10</span>      PAX            <span class="token number">2000.00000000</span>              <span class="token number">0.00000000</span>           <span class="token number">2000.00000000</span>           <span class="token number">1980.00000000</span>
<span class="token number">11</span>      ADA            <span class="token number">1000.00000000</span>              <span class="token number">0.00000000</span>           <span class="token number">1000.00000000</span>           <span class="token number">1100.08000000</span>
<span class="token number">12</span>      TRX           <span class="token number">10000.00000000</span>              <span class="token number">0.00000000</span>          <span class="token number">10000.00000000</span>            <span class="token number">570.00000000</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
        TOTAL                                                                                <span class="token number">173646.14298963</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
</code></pre>
<p>仓位</p>
<pre><code class="prism language-python">positions <span class="token operator">=</span> exchange<span class="token punctuation">.</span>positions<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span>
</code></pre>
<p>返回</p>
<pre><code class="prism language-python"><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"symbol"</span><span class="token punctuation">:</span><span class="token string">"BTC-USDT-SWAP"</span><span class="token punctuation">,</span>
        <span class="token string">"posid"</span><span class="token punctuation">:</span><span class="token string">"392713679413846019"</span><span class="token punctuation">,</span>
        <span class="token string">"tradeid"</span><span class="token punctuation">:</span><span class="token string">"197615835"</span><span class="token punctuation">,</span>
        <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"SWAP"</span><span class="token punctuation">,</span>
        <span class="token string">"mode"</span><span class="token punctuation">:</span><span class="token string">"CROSS"</span><span class="token punctuation">,</span>
        <span class="token string">"side"</span><span class="token punctuation">:</span><span class="token string">"LONG"</span><span class="token punctuation">,</span>
        <span class="token string">"adl"</span><span class="token punctuation">:</span><span class="token string">"5"</span><span class="token punctuation">,</span>
        <span class="token string">"usd"</span><span class="token punctuation">:</span><span class="token string">"10224.72924212015"</span><span class="token punctuation">,</span>
        <span class="token string">"avgprice"</span><span class="token punctuation">:</span><span class="token number">34999</span><span class="token punctuation">,</span>
        <span class="token string">"pos"</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">,</span>
        <span class="token string">"upl"</span><span class="token punctuation">:</span><span class="token number">70.6245</span><span class="token punctuation">,</span>
        <span class="token string">"uplratio"</span><span class="token punctuation">:</span><span class="token number">0.07</span><span class="token punctuation">,</span>
        <span class="token string">"lever"</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token string">"liqprice"</span><span class="token punctuation">:</span><span class="token string">"24942.814155927903"</span><span class="token punctuation">,</span>
        <span class="token string">"margin"</span><span class="token punctuation">:</span><span class="token string">"1022.0334498285887"</span><span class="token punctuation">,</span>
        <span class="token string">"mgnratio"</span><span class="token punctuation">:</span><span class="token number">23.18</span><span class="token punctuation">,</span>
        <span class="token string">"mmr"</span><span class="token punctuation">:</span><span class="token string">"40.88133799314355"</span><span class="token punctuation">,</span>
        <span class="token string">"ccy"</span><span class="token punctuation">:</span><span class="token string">"USDT"</span><span class="token punctuation">,</span>
        <span class="token string">"ctime"</span><span class="token punctuation">:</span><span class="token number">1642914763089</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p>下单</p>
<pre><code class="prism language-python">info <span class="token operator">=</span> exchange<span class="token punctuation">.</span>order<span class="token punctuation">(</span>symbol<span class="token punctuation">,</span> <span class="token string">"SELL"</span><span class="token punctuation">,</span> <span class="token string">"LIMIT"</span><span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">48000</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"CROSS"</span><span class="token punctuation">,</span> posside<span class="token operator">=</span><span class="token string">"SHORT"</span><span class="token punctuation">)</span> <span class="token comment">#期货全仓卖出做空</span>
info <span class="token operator">=</span> exchange<span class="token punctuation">.</span>order<span class="token punctuation">(</span>symbol<span class="token punctuation">,</span> <span class="token string">"SELL"</span><span class="token punctuation">,</span> <span class="token string">"LIMIT"</span><span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">48000</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"CROSS"</span><span class="token punctuation">,</span> posside<span class="token operator">=</span><span class="token string">"LONG"</span><span class="token punctuation">)</span>  <span class="token comment">#期货全仓卖出平空</span>
info <span class="token operator">=</span> exchange<span class="token punctuation">.</span>order<span class="token punctuation">(</span>symbol<span class="token punctuation">,</span> <span class="token string">"BUY"</span><span class="token punctuation">,</span> <span class="token string">"LIMIT"</span><span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">48000</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"CROSS"</span><span class="token punctuation">,</span> posside<span class="token operator">=</span><span class="token string">"LONG"</span><span class="token punctuation">)</span>  <span class="token comment">#期货全仓买入做多</span>
info <span class="token operator">=</span> exchange<span class="token punctuation">.</span>order<span class="token punctuation">(</span>symbol<span class="token punctuation">,</span> <span class="token string">"BUY"</span><span class="token punctuation">,</span> <span class="token string">"LIMIT"</span><span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">48000</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"CROSS"</span><span class="token punctuation">,</span> posside<span class="token operator">=</span><span class="token string">"SHORT"</span><span class="token punctuation">)</span> <span class="token comment">#期货全仓买入平多</span>
</code></pre>
</div>
<link href="./306756356487365_files/markdown_views-22a2fefd3b.css" rel="stylesheet">
<link href="./306756356487365_files/style-4f8fbf9108.css" rel="stylesheet">
</div>
<div id="treeSkill"></div>
</article>
<script>
  $(function() {
    setTimeout(function () {
      var mathcodeList = document.querySelectorAll('.htmledit_views img.mathcode');
      if (mathcodeList.length > 0) {
        var testImg = new Image();
        testImg.onerror = function () {
          mathcodeList.forEach(function (item) {
            $(item).before('<span class="img-codecogs">\\(' + item.alt + '\\)</span>');
            $(item).remove();
          })
          MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
        }
        testImg.src = mathcodeList[0].src;
      }
    }, 1000)
  })
  </script>
</div></body></html>